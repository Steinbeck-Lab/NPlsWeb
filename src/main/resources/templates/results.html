<html xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>NP-likeness scorer - Results</title>



    <link rel="stylesheet" href="/css/main.css" />

    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <!--<link rel="stylesheet" href="/ChemDoodleWeb-8.0.0/install/ChemDoodleWeb.css" type="text/css">
    <script type="text/javascript" src="/ChemDoodleWeb-8.0.0/install/ChemDoodleWeb.js"></script>


    <link rel="stylesheet" href="ChemDoodleWeb-8.0.0/install/uis/jquery-ui-1.11.4.css" type="text/css">
    <script type="text/javascript" src="/ChemDoodleWeb-8.0.0/install/uis/ChemDoodleWeb-uis.js"></script>

-->


    <script src="https://www.lactame.com/lib/openchemlib/5.6.1/openchemlib-full.js"></script>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>


    <link rel="stylesheet" type="text/css" href="/DataTables/datatables.min.css"/>

    <script type="text/javascript" src="/DataTables/datatables.min.js"></script>

</head>




<body>


<div id="headercheminf">
    <a href="https://cheminf.uni-jena.de"><img style="max-width: 100%; max-height:100%;float:right;" src="/img/npls_banner.jpeg"></a>
</div>




<div id="resultsBody">
<div>
    <br><br><br><br>
    <strong>(Scroll down for scores distribution plot)</strong>
</div>



<h2>NPL scores in this session:</h2>
<div id="resultsTable">

    <table id="resultsTableTable" class="display">
        <thead>
        <tr>
            <th>Structure</th>
            <th>NPls unique id</th>
            <th>SMILES</th>
            <th>NPL score</th>
            <th>Total atom count</th>
            <th>Atom count without sugar</th>
            <th>Present in databases as NP</th>
            <!--<th>NPL score (with sugar)</th>-->
        </tr>
        </thead>
        <tbody>
        <tr th:each="score : ${scores}">
            <td> <img th:src="${score.getDepictionLocation()}"> </td>
            <td th:text="${score.getUu_id()}"></td>
            <td th:text="${score.getSmiles()}"></td>
            <td th:text="${  #numbers.formatDecimal(score.getNpl_score(), 1, 2 )  }"></td>
            <td th:text="${score.getAtom_number()}"></td>
            <td th:text="${score.getSugar_free_atom_number()}"></td>
            <td th:switch="${score.getIs_in_any_source()}">
                <div th:case="0"><p>No</p></div>
                <div th:case="1">
                    <ul th:each="source : ${#strings.arraySplit(score.getSources(), ';')}" style="list-style-type:none;line-height:40%;text-align:left;">

                            <li th:text="${source}"></li>

                    </ul>
                </div>
                <div th:case="*"><p>No</p></div>
            </td>
            <!--<td th:text="${  #numbers.formatDecimal(score.getNpl_sugar_score(), 1, 2 )  }"></td>-->
        </tr>

        </tbody>
    </table>



</div>


<div id="resubmit" style="clear: both;">
    <br><br>
    <form action="/">
        <input type="submit" value="Compute new NP-likeness score(s)" />
    </form>
</div>

<div>

    <strong>Clic on the databases or taxonomic kingdoms to toggle the NP-likeness score distributions</strong>

</div>

<div id="npPanel" style="width: 100%; height:700px;"><!-- Plotly chart will be drawn inside this DIV --></div>


<div>

    <!--<p>[1] Jayaseelan et al.,  Natural product-likeness score revisited: an open-source, open-data implementation.
        In: BMC Bioinformatics, 13 (1), pp. 106, 2012.</p>-->
</div>


<div id="resubmit">
    <br><br>
    <form action="/">
        <input type="submit" value="Compute new NP-likeness score(s)" />
    </form>
</div>

</div>



<!--
**********************************************************************************
SCRIPTS
-->


<!-- table configuration-->
<script>
    $(document).ready( function () {
        $('#resultsTableTable').DataTable(
            {
                dom: '<"top"ifl>rt<"bottom"Bp>',
                buttons: [
                    'colvis', 'excel', 'csv', 'copy'
                ],
                "columnDefs": [
                    {
                        "targets": [ 5 ], //atom number without sugars
                        "visible": false
                    },
                    {
                        "className": "dt-center",
                        "targets": "_all"
                    }
                ]
            }

        );
    } );
</script>


<!-- Plot -->
<script th:inline="javascript">
    /*<![CDATA[*/

    // ***************************************
    //getting data from Spring Controller
    let npXdata = /*[[${npXdataNP}]]*/ 'default';
    let npYdata = /*[[${npYdataNP}]]*/ 'default';

    let npXdataSM = /*[[${npXdataSM}]]*/ 'default';
    let npYdataSM = /*[[${npYdataSM}]]*/ 'default';


    // by taxonomy
    let npXdataBACTERIA = /*[[${npXbacteria}]]*/ 'default';
    let npYdataBACTERIA = /*[[${npYbacteria}]]*/ 'default';

    let npXdataFUNGI = /*[[${npXfungi}]]*/ 'default';
    let npYdataFUNGI = /*[[${npYfungi}]]*/ 'default';

    let npXdataPLANTS = /*[[${npXplants}]]*/ 'default';
    let npYdataPLANTS = /*[[${npYplants}]]*/ 'default';

    //by DB
    let npXdataCHEBI = /*[[${npXchebi}]]*/ 'default';
    let npYdataCHEBI = /*[[${npYchebi}]]*/ 'default';

    let npXdataTCMDB = /*[[${npXtcmdb}]]*/ 'default';
    let npYdataTCMDB = /*[[${npYtcmdb}]]*/ 'default';

    let npXdataZINCNP = /*[[${npXzincnp}]]*/ 'default';
    let npYdataZINCNP = /*[[${npYzincnp}]]*/ 'default';

    let npXdataPUBCHEM = /*[[${npXpubchem}]]*/ 'default';
    let npYdataPUBCHEM = /*[[${npYpubchem}]]*/ 'default';

    let npXdataCHEMBL = /*[[${npXchembl}]]*/ 'default';
    let npYdataCHEMBL = /*[[${npYchembl}]]*/ 'default';

    let npXdataNPATLAS = /*[[${npXnpatlas}]]*/ 'default';
    let npYdataNPATLAS = /*[[${npYnpatlas}]]*/ 'default';

    let npXdataNUBBE = /*[[${npXnubbe}]]*/ 'default';
    let npYdataNUBBE = /*[[${npYnubbe}]]*/ 'default';

    let npXdataSANCDB = /*[[${npXsancdb}]]*/ 'default';
    let npYdataSANCDB = /*[[${npYsancdb}]]*/ 'default';

    let npXdataDRUGBANK = /*[[${npXdrugbank}]]*/ 'default';
    let npYdataDRUGBANK = /*[[${npYdrugbank}]]*/ 'default';

    let npXdataHMDB = /*[[${npXhmdb}]]*/ 'default';
    let npYdataHMDB = /*[[${npYhmdb}]]*/ 'default';

    let npXdataOLD2012 = /*[[${npXold2012}]]*/ 'default';
    let npYdataOLD2012 = /*[[${npYold2012}]]*/ 'default';

    let npXdataSUPERNATURAL = /*[[${npXsupernatural}]]*/ 'default';
    let npYdataSUPERNATURAL = /*[[${npYsupernatural}]]*/ 'default';

    let npXdataAFRODB = /*[[${npXafrodb}]]*/ 'default';
    let npYdataAFRODB = /*[[${npYafrodb}]]*/ 'default';


    let npXac100 = /*[[${npXac100}]]*/ 'default';
    let npYac100 = /*[[${npYac100}]]*/ 'default';

    let npXac100200 = /*[[${npXac100200}]]*/ 'default';
    let npYac100200 = /*[[${npYac100200}]]*/ 'default';

    let npXac200300 = /*[[${npXac200300}]]*/ 'default';
    let npYac200300 = /*[[${npYac200300}]]*/ 'default';

    let npXac300 = /*[[${npXac300}]]*/ 'default';
    let npYac300 = /*[[${npYac300}]]*/ 'default';





    // the computed user scores
    let scoresObject = /*[[${scores}]]*/ 'default';

    // data obtained
    // ***************************************

    let globalCounts = /*[[${globalCounts}]]*/ 'default';



    console.log( Plotly.BUILD );

    // ***************************************
    //building object to trace for computed scores

    let xnpuser = new Array();
    let ynpuser = new Array();
    let tnpuser = new Array();

    console.log(scoresObject);

    for(var i = 0; i< scoresObject.length; i++){
        score = scoresObject[i];
        xnpuser.push( Number(( score.npl_score).toFixed(2)) );


        ynpuser.push(0.002);
        tnpuser.push(score.uu_id);
    }

    var traceUserNPScores = {
        x: xnpuser,
        y: ynpuser,
        mode: 'markers',
        name: 'Computed score(s)',
        text: tnpuser,
        //textposition: 'top',
        type: 'scatter',
        hoverinfo:'text',
        marker: {
            color: 'rgb(255, 0, 0)',
            size: 12,
            line: {
                color: 'rgb(153, 0, 0)',
                width: 1
            }
        }
    };

    // ***************************************

    // ***************************************
    // building object to trace for all NP
    // building object to trace for all NP
    var traceNP = {
        x: npXdata,
        y: npYdata ,
        //legendgroup: 'general',
        mode: 'lines',
        name: 'All Natural Products ('+globalCounts.countAllNP +')' ,
        line: {
            shape: 'spline',
            // color: 'rgb(0, 152, 76)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // ***************************************

    // ***************************************
    // building object to trace for all SM

    var traceSM = {
        x: npXdataSM,
        y: npYdataSM ,
        //legendgroup: 'general',
        mode: 'lines',
        name: 'All Synthetic Products ('+globalCounts.countAllSM+')',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // ***************************************
    // building object to trace for BACTERIA

    var traceBACTERIA = {
        x: npXdataBACTERIA,
        y: npYdataBACTERIA ,
        //legendgroup: 'bytaxonomy',
        mode: 'lines',
        name: 'Bacteria ('+globalCounts.countBacteria+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // ***************************************
    // building object to trace for FUNGI

    var traceFUNGI = {
        x: npXdataFUNGI,
        y: npYdataFUNGI ,
        //legendgroup: 'bytaxonomy',
        mode: 'lines',
        name: 'Fungi ('+globalCounts.countFungi+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // ***************************************
    // building object to trace for PLANTS

    var tracePLANTS = {
        x: npXdataPLANTS,
        y: npYdataPLANTS ,
        //legendgroup: 'bytaxonomy',
        mode: 'lines',
        name: 'Plants ('+globalCounts.countPlants+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            //color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // ***************************************


    // building object to trace for CHEBI

    var traceCHEBI = {
        x: npXdataCHEBI,
        y: npYdataCHEBI ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'ChEBI Natural Products ('+globalCounts.countCHEBI+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // building object to trace for TCMDB

    var traceTCMDB = {
        x: npXdataTCMDB,
        y: npYdataTCMDB ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'TCMDB ('+globalCounts.countTCMDB+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // building object to trace for ZINC NP

    var traceZINCNP = {
        x: npXdataZINCNP,
        y: npYdataZINCNP ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'ZINC Natural Products ('+globalCounts.countZINCNP+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for PUBCHEM

    var tracePUBCHEM = {
        x: npXdataPUBCHEM,
        y: npYdataPUBCHEM ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'PubChem Natural Products ('+globalCounts.countPUBCHEM+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for CHEMBL

    var traceCHEMBL = {
        x: npXdataCHEMBL,
        y: npYdataCHEMBL ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'ChEMBL Natural Products ('+globalCounts.countCHEMBL+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for ZINC NP

    var traceNPATLAS = {
        x: npXdataNPATLAS,
        y: npYdataNPATLAS ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'NP Atlas ('+globalCounts.countNPATLAS+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for NUBBE

    var traceNUBBE = {
        x: npXdataNUBBE,
        y: npYdataNUBBE ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'NuBBE ('+globalCounts.countNUBBE+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for SANCDB

    var traceSANCDB = {
        x: npXdataSANCDB,
        y: npYdataSANCDB ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'SANCDB ('+globalCounts.countSANCDB+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for SUPERNATURAL

    var traceSUPERNATURAL = {
        x: npXdataSUPERNATURAL,
        y: npYdataSUPERNATURAL ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'Supernatural II ('+globalCounts.countSUPERNATURAL+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for AFRODB

    var traceAFRODB = {
        x: npXdataAFRODB,
        y: npYdataAFRODB ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'AfroDB ('+globalCounts.countAFRODB+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for OLD2012

    var traceOLD2012 = {
        x: npXdataOLD2012,
        y: npYdataOLD2012 ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'Manually curated NP dataset ('+globalCounts.countOld2102+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    // building object to trace for HMDB

    var traceHMDB = {
        x: npXdataHMDB,
        y: npYdataHMDB ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'HMDB',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // building object to trace for DRUGBANK

    var traceDRUGBANK = {
        x: npXdataDRUGBANK,
        y: npYdataDRUGBANK ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'DrugBank ('+globalCounts.countDRUGBANK+')',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // building object to trace for BY SIZE

    var traceAC100 = {
        x: npXac100,
        y: npYac100 ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'molecule size < 100 atoms (SM & NP)',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    var traceAC100200 = {
        x: npXac100200,
        y: npYac100200 ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'molecule size between 100 and 200 atoms (SM & NP)',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    var traceAC200300 = {
        x: npXac200300,
        y: npYac200300 ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'molecule size between 200 and 300 atoms (SM & NP)',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };

    var traceAC300 = {
        x: npXac300,
        y: npYac300 ,
        //legendgroup: 'bydatabase',
        mode: 'lines',
        name: 'molecule size >=300 atoms (SM & NP)',
        visible: 'legendonly',
        line: {
            shape: 'spline',
            // color: 'rgb(76, 0, 153)',
            width: 2
        },
        type: 'scatter',
        hoverinfo:'x',
    };


    // ***************************************


    // ***************************************
    // Prepare and plot

    let data = [traceUserNPScores, traceNP, traceSM, traceOLD2012, traceSUPERNATURAL, traceCHEBI, traceTCMDB, traceZINCNP, tracePUBCHEM,
        traceCHEMBL, traceNPATLAS, traceNUBBE, traceSANCDB, traceAFRODB, traceDRUGBANK, traceBACTERIA,
        traceFUNGI, tracePLANTS,  traceAC100, traceAC100200, traceAC200300, traceAC300]; //traceBACTERIA, traceFUNGI, tracePLANTS, traceHMDB,

    let layout = {


        xaxis: {
            title: "Natural Products Likeness Score",
            range: [-4,6]
        },
        yaxis: {
            title: "Density",
            range: [0,0.1]
        },
        colorway: 'Rainbow'
    };


    Plotly.newPlot('npPanel', data, layout);

    // ***************************************

    /*]]>*/
</script>

<!--

&lt;!&ndash; Molecule depiction TODO &ndash;&gt;
<script th:inline="javascript">
    /*<![CDATA[*/





        let scores = /*[[${scores}]]*/ 'default';
        window.addEventListener("load", draw);
        function draw() {



            for(var i=0; i< scores.length; i++) {
                let molecule = scores[i];
                var mol = OCL.Molecule.fromSmiles(molecule["smiles"]);

                let molCanvas = "#canvas" + molecule["umol_id"];
                console.log(molCanvas);
                var ctx = document.querySelector(molCanvas).getContext('2d');


                var img1 = new Image();
                img1.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(mol.toSVG());
                img1.onload = function() {
                    img1.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(mol.toSVG());
                    ctx.drawImage(img1, 100, 100);
                    ctx.fillRect(0, 0, 150, 75);
                }

                img1.src = 'data:image/svg+xml;charset=utf-8,' + encodeURIComponent(mol.toSVG());

            }
        }








    function drawMolecules(OCL) {

        var smilesDrawer=new SmilesDrawer();
        var canvas=document.createElement('canvas');
        //console.log(document.getElementsByTagName('resultsTableTable') ) ;//[0].appendChild(canvas)


/*


        var results=[];
        var start=new Date();
        for (var smile of smiles) {
            console.log(smile);
            var data = SmilesDrawer.parse(smile);
            smilesDrawer.draw(data, canvas);


            var molecule=OCL.Molecule.fromSmiles(smile);
            results.push({
                smiles:smile,
                svg: molecule.toSVG(200, 150, Math.random.toString(36), {fontWeight: 900}),
                img: canvas.toDataURL()
            })
        }

        API.createData('results', results);
        API.createData('timePerSVG',(new Date()-start)/smiles.length);
*/




        /*]]>*/
    }

</script>
-->

</body>
</html>